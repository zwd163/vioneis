# 设置 IP 监控计划任务

本文档介绍如何在 Windows 系统上设置自动 IP 监控计划任务，以便在服务器 IP 变化时自动发送通知邮件。

## 前提条件

1. 已安装 GreaterWMS 系统
2. 已配置好邮件发送功能
3. 具有管理员权限

## 设置 Windows 计划任务

### 步骤 1: 打开任务计划程序

1. 按下 `Win + R` 组合键，打开运行对话框
2. 输入 `taskschd.msc` 并按回车键
3. 这将打开 Windows 任务计划程序

### 步骤 2: 创建新任务

1. 在右侧操作面板中，点击 "创建基本任务"
2. 输入任务名称，例如 "GreaterWMS IP 监控"，并添加描述（可选）
3. 点击 "下一步"

### 步骤 3: 设置触发器

1. 选择任务运行的频率，建议选择 "每天"
2. 点击 "下一步"
3. 设置开始时间，例如每天早上 8:00
4. 点击 "下一步"

### 步骤 4: 设置操作

1. 选择 "启动程序"
2. 点击 "下一步"
3. 在 "程序或脚本" 字段中，输入批处理文件的完整路径：
   ```
   E:\Work\github\vioneis\scripts\check_ip_change.bat
   ```
   （请根据您的实际安装路径进行修改）
4. 在 "起始于" 字段中，输入项目根目录：
   ```
   E:\Work\github\vioneis
   ```
   （请根据您的实际安装路径进行修改）
5. 点击 "下一步"

### 步骤 5: 完成设置

1. 检查任务摘要
2. 勾选 "当点击完成时，打开此任务属性的对话框"
3. 点击 "完成"

### 步骤 6: 配置高级选项

在打开的属性对话框中：

1. 在 "常规" 选项卡中，勾选 "使用最高权限运行"
2. 在 "设置" 选项卡中，根据需要配置其他选项：
   - 勾选 "允许按需运行任务"
   - 勾选 "如果任务运行时间超过以下时间，则停止任务"，并设置为 30 分钟
   - 勾选 "如果请求的时间已过，则尽快启动"
3. 点击 "确定" 保存设置

## 测试计划任务

1. 在任务计划程序中，找到您刚创建的任务
2. 右键点击任务，选择 "运行"
3. 检查任务是否成功执行
4. 查看日志文件 `logs/server.log` 确认 IP 检查是否正常运行

## 多次运行

如果您希望每天多次检查 IP 变化，可以：

1. 在任务计划程序中，右键点击您创建的任务，选择 "属性"
2. 切换到 "触发器" 选项卡
3. 点击 "编辑"
4. 选择 "每天"，然后在 "重复任务间隔" 部分：
   - 勾选 "每隔 X 小时/分钟重复一次"
   - 设置重复间隔，例如 "4 小时"
   - 设置 "持续时间" 为 "1 天"
5. 点击 "确定" 保存设置

## 故障排除

如果计划任务未正常运行：

1. 检查批处理文件路径是否正确
2. 确保虚拟环境路径正确
3. 检查用户权限是否足够
4. 查看 Windows 事件查看器中的任务计划程序日志
5. 手动运行批处理文件，查看是否有错误信息

## 注意事项

- 确保服务器始终处于运行状态，否则计划任务将无法执行
- 如果服务器重启，请确保计划任务能够自动恢复
- 定期检查日志文件，确保 IP 监控功能正常运行
